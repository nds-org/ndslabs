<!-- The Add / Edit Spec View -->
<section>
    <form name="modifySpec" ng-submit="save()">
        <div class="row">
            <div class="col-xs-12">
                <h3>{{ editingSpec ? 'Edit' : 'Add' }} Application<span ng-if="spec.label">: {{ spec.label }}</span></h3>
                
                <ol class="breadcrumb">
                    <!-- <li><a ng-href="{{ productUrl }}">{{ productName }}</a></li> -->
                    <li><a href="/landing/">{{ productName }}</a></li>
                    <li><a ng-href="/dashboard/home">Applications</a></li>
                    <li><a ng-href="/dashboard/store">Catalog</a></li>
                    <li class="active">{{ editingSpec ? spec.label : 'Add Application' }}</li>
                </ol>
                                
                <div ng-if="spec.key | stackExistsFromSpec" uib-alert class="text-center alert-danger">You must remove any <a ng-href="/dashboard/home?expand={{ spec.key }}">existing application instances</a> before you can edit the spec</div>
        
                <div class="row">
                    <div class="col-sm-12">
                        <uib-tabset active="activeTab">
                            <uib-tab heading="Details" index="0" id="detailsTab">
                                <!-- Application Spec Details -->
                                <div class="row">
                                    <div class="col-sm-6">
                                        <fieldset class="border-nds">
                                            <legend class="legend-fix">Application Details <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="bottom-right" uib-tooltip="Some details about the application itself"></i></sup></legend>
                                            <!-- Short Name (Key) -->
                                            <div class="form-group" >
                                                <label for="keyField">Short Name <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The database key for this application (must be lowercase with no special characters)"></i></sup></label>
                                                <input type="text" class="form-control" id="keyField" name="keyField" placeholder="Short Name"
                                                    ng-model="spec.key" ng-disabled="editingSpec" required ng-pattern="/^[a-z][a-z0-9]+$/" />
                                                
                                                <p class="text-danger" ng-if="!keyUnique">This key is already in use</p>
                                                <ng-messages class="text-danger" for="modifySpec.keyField.$error" role="alert">
                                                  <ng-message when="required">This field is required</ng-message>
                                                  <ng-message when="pattern">This field may only contain lowercase alphanumeric characters</ng-message>
                                                </ng-messages>
                                            </div>
                                            
                                            <!-- Display Name -->
                                            <div class="form-group">
                                                <label for="nameField">Display Name <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="A common, human-readable display name for your service"></i></sup></label>
                                                <input type="text" class="form-control" id="nameField" name="nameField" placeholder="Display Name" 
                                                    ng-model="spec.label" required>
                                                
                                                <ng-messages class="text-danger" for="modifySpec.nameField.$error" role="alert">
                                                  <ng-message when="required">This field is required</ng-message>
                                                </ng-messages>
                                            </div>
                                            
                                            <!-- Logo URL (optional) -->
                                            <!-- All user specs in the catalog will default to using the NDS badge -->
                                            <div class="form-group">
                                                <label for="logoField">Logo <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="A URL to a small logo for this service"></i></sup></label>
                                                <input class="form-control" id="logoField" name="logoField" placeholder="Enter Logo URL..." ng-pattern="/^((\/.+)+|(https?:\/\/)?(www\.)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/?.*))$/" ng-model="spec.logo">
                                                
                                                <ng-messages class="text-danger" for="modifySpec.logoField.$error" role="alert">
                                                  <ng-message when="pattern">Please enter a valid URL pattern</ng-message>
                                                </ng-messages>
                                            </div>
                                            
                                            <!-- Info URL (optional) -->
                                            <div class="form-group">
                                                <small class="pull-right">Create a page <i><a id="infoLinkHelperLink" ng-href="https://nationaldataservice.atlassian.net/wiki/display/NDSC/NDS+Labs+Services/" target="_blank">here</a></i> and link to it!</small>
                                                
                                                <label for="infoLinkField">Information <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="top-right" uib-tooltip="Link to the NDS Confluence wiki where the user can find more information about this service"></i></sup></label>
                                                
                                                <input type="url" class="form-control" id="infoLinkField" name="infoLinkField" placeholder="Enter Info URL..." ng-model="spec.info" ng-pattern="/^https://nationaldataservice\.atlassian\.net/wiki/display/NDSC/[^\s]+/" />
                                                
                                                <ng-messages class="text-danger" for="modifySpec.infoLinkField.$error" role="alert">
                                                  <ng-message when="url">Please provide a valid url.</ng-message>
                                                  <ng-message when="pattern">Please provide a valid subpage of the <a ng-href="https://nationaldataservice.atlassian.net/wiki/display/NDSC/NDS+Labs+Services/" target="_blank">NDS Confluence wiki</a>.</ng-message>
                                                </ng-messages>
                                            </div>
                                            
                                            <!-- Maintainer E-mail (optional) -->
                                            <div class="form-group">
                                                <label for="maintainerField">Maintainer <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="Who is in charge of updating this application/image when new releases occur?"></i></sup></label>
                                                <input type="email" class="form-control" id="maintainerField" name="maintainerField" placeholder="Enter Maintainer E-mail..." ng-model="spec.maintainer">
                                                
                                                <ng-messages class="text-danger" for="modifySpec.maintainerField.$error" role="alert">
                                                  <ng-message when="email">Please enter a valid e-mail address</ng-message>
                                                </ng-messages>
                                            </div>
                                            
                                            <!-- Description (optional) -->
                                            <div class="form-group">
                                                <label for="descriptionField">Description <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="Catalog description of the application"></i></sup></label>
                                                <textarea type="text" class="form-control" id="descriptionField" placeholder="Enter a description of this application (optional)" ng-model="spec.description"></textarea>
                                            </div>
                                        
                                            <!-- Service access -->
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <!-- Default Access -->
                                                    <div class="form-group">
                                                        <div><label>Default Access <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="Who can access this application by default (can be overridden on a per-instance basis)"></i></sup></label></div>
                                                        <div class="btn-group" role="group">
                                                            <!-- Access: External -->
                                                            <button id="externalAccessBtn" type="button" class="btn" ng-click="spec.access='external'" uib-tooltip="Publicly-accessible"
                                                                    ng-class="{ 'btn-default':spec.access !== 'external', 'btn-primary':spec.access === 'external' }">
                                                                <span class="fa-stack">
                                                                  <i class="fa fa-globe fa-stack-2x text-muted"></i>
                                                                  <i class="fa fa-eye fa-stack-1x"></i>
                                                                </span>
                                                            </button>
                                                            
                                                            <!-- Access: Internal  -->
                                                            <button id="internalAccessBtn" type="button" class="btn" ng-click="spec.access='internal'" uib-tooltip="Accessible to other service within the cluster"
                                                                    ng-class="{ 'btn-default':spec.access !== 'internal', 'btn-primary':spec.access === 'internal' }" >
                                                                <span class="fa-stack">
                                                                  <i class="fa fa-cloud fa-stack-2x text-muted"></i>
                                                                  <i class="fa fa-eye fa-stack-1x"></i>
                                                                </span>
                                                            </button>
                                                            
                                                            <!-- Access: None -->
                                                            <button id="noAccessBtn" type="button" class="btn" ng-click="spec.access='none'" uib-tooltip="Completely isolated"
                                                                    ng-class="{ 'btn-default':spec.access !== 'none', 'btn-primary':spec.access === 'none' }" >
                                                               <span class="fa-stack">
                                                                  <i class="fa fa-eye fa-stack-1x"></i>
                                                                  <i class="fa fa-ban fa-stack-2x text-danger"></i>
                                                                </span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Tags (optional) -->
                                            <div class="form-group">
                                                <label for="keywordsField">Keywords <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="Choose search filter keywords that would allow users to easily discover this application"></i></sup></label>
                                                <ul class="fa-ul">
                                                    <li ng-repeat="tagId in spec.tags" class="item">
                                                        <i class="fa-li fa fa-search"></i>
                                                        <div class="row">
                                                            <div class="col-xs-8" id="searchTagText">{{ tagId | tagProperty:'name' }}</div>
                                                            <div class="col-xs-4">
                                                                <button id="removeTagBtn" type="button" class="btn btn-xs btn-default pull-right" ng-click="spec.tags.splice(spec.tags.indexOf(tag), 1)">
                                                                    <i class="fa fa-fw fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </div> 
                                                    </li>
                                                </ul>
                                                
                                                <!-- Add new tag -->
                                                <div class="row">
                                                    <div class="col-xs-8">
                                                        <select id="newTagSelect" class="form-control" ng-model="newKeyword">
                                                            <option ng-repeat="tag in tags" ng-value="{{ tag.id }}">{{ tag.name }}</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-xs-4">
                                                        <button id="addTagBtn" type="button" class="btn btn-primary pull-right" ng-click="addKeyword(newKeyword)" ng-disabled="!newKeyword"><i class="fa fa-fw fa-plus"></i> Add</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                
                                    <!-- Docker Image Details -->
                                    <div class="col-sm-6" style="height:100% !important;">
                                        <fieldset class="border-nds">
                                            <legend class="legend-fix">Docker Details <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="bottom-right" uib-tooltip="Some details about the underlying Docker image for this application"></i></sup></legend>
                                            
                                            <!-- Docker Registry -->
                                            <!-- TODO: Do we support different registries? -->
                                            <div class="form-group">
                                                <label for="registryField">Registry <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="Coming Soon!"></i></sup></label>
                                                <input type="text" class="form-control" id="registryField" placeholder="Docker Registry" value="docker.io" ng-disabled="true">
                                            </div>
                                            
                                            <!-- Docker Image -->
                                            <div class="form-group">
                                                <label for="imageNameField">Image Name <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The main Docker image for this application"></i></sup></label>
                                                <input type="text" class="form-control" id="imageNameField" name="imageNameField" placeholder="Enter a Docker image name..." 
                                                    ng-model="spec.image.name" required ng-pattern="/^([a-z0-9]+\/)?[0-9a-z]+(([-_\.]?[0-9a-z]+))*$/">
                                                <ng-messages class="text-danger" for="modifySpec.imageNameField.$error" role="alert">
                                                  <ng-message when="required">This field is required</ng-message>
                                                  <ng-message when="pattern">This field must be formatted as "image-name" or "user/image-name"</ng-message>
                                                </ng-messages>
                                            </div>
                                            
                                            <!-- Docker Tags -->
                                            <div class="form-group">
                                                <label for="imageTagField">Image Tags <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="Accessible Docker version tags for {{ spec.image.name || 'this image' }}"></i></sup></label>
                                                <ul class="fa-ul">
                                                    <li ng-repeat="tag in spec.image.tags" class="item">
                                                        <i class="fa-li fa fa-tag"></i>
                                                        <div class="row">
                                                            <div class="col-xs-8" id="dockerTagText">{{ tag }}<span ng-if="$index === 0"> (Default)</span></div>
                                                            <div class="col-xs-4">
                                                                <button id="removeDockerTagBtn" type="button" class="btn btn-xs btn-default pull-right" ng-click="spec.image.tags.splice(spec.image.tags.indexOf(tag), 1)">
                                                                    <i class="fa fa-fw fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </div> 
                                                    </li>
                                                </ul>
                                                
                                                <!-- Add new tag -->
                                                <div class="row">
                                                    <div class="col-sm-11">
                                                        <!-- <input style="width:100%;" class="form-control" ng-model="newDepName" placeholder="Key of another Application..." /> -->
                                                        <input id="newDockerTagNameField" name="newDockerTagNameField" class="form-control" ng-model="newTag" placeholder="Enter a Docker tag name..." />
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button id="addDockerTagBtn" type="button" class="btn btn-primary btn-xs pull-right" ng-disabled="!newTag || (spec.image.tags && spec.image.tags.indexOf(newTag) !== -1)" ng-click="spec.image.tags.push(newTag);newTag=''">
                                                            <i class="fa fa-fw fa-plus"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <!-- TODO: Manual validation here kind of sucks... -->
                                                <div class="text-info" ng-if="!spec.image.tags || spec.image.tags.length === 0">If no tags are specified, "latest" will be assumed</div>
                                            </div>
                                            
                                            <!-- Container Commands -->
                                            <div class="form-group">
                                                <label for="cmdField">Command <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The command to run when starting a Docker container from the above image"></i></sup></label>
                                                <input type="text" class="form-control" id="cmdField" name="cmdField" placeholder="Command (optional)..." ng-model="spec.command">
                                            </div>
                                            
                                            <!-- Container Command Args -->
                                            <div class="form-group">
                                                <label for="argsField">Arguments <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="Any arguments that should be passed in to the command above"></i></sup></label>
                                                <input type="text" class="form-control" id="argsField" name="argsField" placeholder="Command arguments (optional)..." ng-model="spec.args">
                                            </div>
                                            
                                            <!-- Container Readiness Type -->
                                            <div class="form-group">
                                                <label for="readinessProbeType">Readiness Probe  <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="How will we know that the container has successfully started?"></i></sup></label>
                                                <select id="readinessProbeTypeSelect" class="form-control" ng-model="probe.type">
                                                    <option value="">None</option>
                                                    <option value="http">HTTP GET</option>
                                                    <option value="tcp">TCP Socket</option>
                                                </select>
                                            </div>
                                            
                                            <!-- Readiness Probe Parameters -->
                                            <div ng-if="probe.type !== ''">
                                                <!-- HTTP GET options -->
                                                <div class="row" ng-if="probe.type === 'http'">
                                                    <div class="col-xs-8">
                                                        <div class="form-group">
                                                            <label for="readinessProbePath">Probe Path <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="What is the path we should hit to check if the container is ready?"></i></sup></label>
                                                            <input class="form-control" type="text" required ng-pattern="/^\/[^\s]*$/" name="readinessProbePath" id="readinessProbePath" ng-model="probe.path" placeholder="Path..." />
                                                            
                                                            <ng-messages role="alert" class="text-danger" for="modifySpec.readinessProbePath.$error">
                                                                <ng-message when="required">You must enter a path to use HTTP GET probe</ng-message>
                                                                <ng-message when="pattern">This value must be a valid path (i.e. /favicon.ico)</ng-message>
                                                            </ng-messages>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-xs-4">
                                                        <div class="checkbox">
                                                            <label ng-click="toggleHttps()">
                                                                <input id="readinessProbeHttpsCheckbox" type="checkbox" ng-checked="probe.port === 443" /> Use HTTPS?
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="form-group">
                                                    <label for="readinessProbePort">Probe Port <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="Which port should we hit to check if the container is ready?"></i></sup></label>
                                                    <input class="form-control" type="number" required min="1" max="65535" name="readinessProbePort" id="readinessProbePort" ng-model="probe.port" placeholder="Port..." />
                                                    
                                                    <ng-messages role="alert" class="text-danger" for="modifySpec.readinessProbePort.$error">
                                                        <ng-message when="required">You must enter a port number for the probe</ng-message>
                                                        <ng-message when="min,max">This value must be a valid port number (1 - 65535)</ng-message>
                                                    </ng-messages>
                                                </div>
                                                
                                                <!-- Timing options -->
                                                <div class="row">
                                                    <div class="col-xs-6">
                                                        <div class="form-group" ng-if="probe.type !== ''">
                                                            <label for="readinessProbeDelay">Initial Delay <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="How many seconds should we wait before beginning the ready check?"></i></sup></label>
                                                            <input class="form-control" type="number" required min="0" max="600" name="readinessProbeDelay" id="readinessProbeDelay" ng-model="probe.initialDelay" placeholder="Initial Delay..." />
                                                            
                                                            <ng-messages role="alert" class="text-danger" for="modifySpec.readinessProbeDelay.$error">
                                                                <ng-message when="required">You must choose an initial delay</ng-message>
                                                                <ng-message when="min,max">This value must be between 0 and 600 (10 minutes)</ng-message>
                                                            </ng-messages>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-xs-6">
                                                        <div class="form-group" ng-if="probe.type !== ''">
                                                            <label for="readinessProbeTimeout">Timeout <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="How many seconds should we probe after starting the ready check?"></i></sup></label>
                                                            <input class="form-control" type="number" required min="0" max="600" name="readinessProbeTimeout" id="readinessProbeTimeout" ng-model="probe.timeout" placeholder="Timeout..." />
                                                            
                                                            <ng-messages role="alert" class="text-danger" for="modifySpec.readinessProbeTimeout.$error">
                                                                <ng-message when="required">You must choose a timeout period</ng-message>
                                                                <ng-message when="min,max">This value must be between 0 and 600 (10 minutes)</ng-message>
                                                            </ng-messages>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </uib-tab>
                            
                            <uib-tab heading="Dependencies" index="2" id="dependenciesTab">
                                <!-- List / edit mapped dependencies -->
                                <div class="row">
                                    <div class="col-sm-12">
                                        <fieldset class="border-nds">
                                            <legend class="legend-fix">Dependencies <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="bottom-right" uib-tooltip="Should any other services be started with this application?"></i></sup></legend>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-condensed table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th width="45%">Service</th>
                                                            <th width="45%">Required?</th>
                                                            <th width="10%"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr ng-repeat="dep in spec.depends">
                                                            <td id="depLabelText">{{ dep.key | specProperty:'label' }} <span class="pull-right">({{ dep.key }})</span></td>
                                                            <td><input id="depRequiredCheckbox" type="checkbox" class="checkbox" ng-model="dep.required" /></td>
                                                            <td><button id="removeDepBtn" type="button" class="btn btn-xs btn-default" ng-click="removeItem(spec.depends, dep)"><i class="fa fa-fw fa-trash"></i></button></td>
                                                        </tr>
                                                        
                                                        <!-- Add new dependency -->
                                                        <tr>
                                                            <td><select id="newDepSelect" class="form-control" ng-model="newDep">
                                                                <option ng-repeat="dep in spec.depends | invertSpecList:spec.key | orderBy:'label' track by dep.key" value="{{ dep.key }}">{{ dep.label }} <{{ dep.key }}></option>
                                                            </select></td>
                                                            <td><input id="newDepRequiredCheckbox" type="checkbox" class="checkbox" ng-model="newDepReq" /></td>
                                                            <td>
                                                                <button id="addNewDepBtn" type="button" class="btn btn-primary btn-xs" ng-disabled="!newDep" ng-click="addItem('depends', { key: newDep, required: newDepReq });newDep=''">
                                                                    <i class="fa fa-fw fa-plus"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </uib-tab>
                            
                            <!-- Environment Tab -->
                            <uib-tab heading="Environment" index="4" id="environmentTab">
                                <!-- List / edit mapped environment variables -->
                                <div class="row">
                                    <div class="col-sm-12">
                                        <fieldset class="border-nds">
                                            <legend class="legend-fix">Environment Variables <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="bottom-right" uib-tooltip="You can access these values inside of your container using the syntax: ${VAR_NAME}"></i></sup></legend>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-condensed table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th width="25%">Name</th>
                                                            <th width="20%">Label</th>
                                                            <th width="40%">Default Value</th>
                                                            <th width="5%">Can Override?</th>
                                                            <th width="5%">Is Password?</th>
                                                            <th width="5%"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr ng-repeat="cfg in spec.config">
                                                            <!-- Name -->
                                                            <td id="cfgNameText">{{ cfg.name }}</td>
                                                            
                                                            <!-- Label -->
                                                            <td id="cfgLabelText">{{ cfg.label }}</td>
                                                            
                                                            <!-- Config value / setTo / useFrom -->
                                                            <td id="cfgTypeText">
                                                                <span ng-if="cfg.type === 'Set To'">Set {{ cfg.setTo }} to {{ cfg.value }}</span>
                                                                <span ng-if="cfg.type === 'Use From'">Use From: {{ cfg.useFrom }}</span>
                                                                <span ng-if="cfg.type === 'Explicit'">{{ cfg.value }}</span>
                                                            </td>
                                                            
                                                            <!-- Can Override? -->
                                                            <td><input id="cfgCanOverrideCheckbox" type="checkbox" class="checkbox" ng-model="cfg.canOverride"  /></td>
                                                            
                                                            <!-- Is Password? -->
                                                            <td><input id="cfgIsPasswordCheckbox" type="checkbox" class="checkbox" ng-model="cfg.isPassword" /></td>
                                                            
                                                            <!-- Delete button -->
                                                            <td><button id="removeCfgBtn" type="button" class="btn btn-xs btn-default" ng-click="removeItem(spec.config, cfg)"><i class="fa fa-fw fa-trash"></i></button></td>
                                                        </tr>
                                                
                                                        <!-- Add new environment variable -->
                                                        <tr>
                                                            <!-- New Config Name -->
                                                            <td>
                                                                <input class="form-control" ng-model="newCfgName" id="newCfgNameField" name="newCfgNameField" placeholder="Variable name..." minlength="0" maxlength="80" ng-pattern="/^[a-zA-Z_]+[a-zA-Z0-9_]*$/" />
                                                                <ng-messages role="alert" class="text-danger" for="modifySpec.newCfgNameField.$error">
                                                                    <ng-message when="pattern">This value may only contain letters and underscore</ng-message>
                                                                    <ng-message when="minlength,maxlength">This value must be between 1 and 80 characters</ng-message>
                                                                </ng-messages>
                                                            </td>
                                                            
                                                            <!-- New Config Label -->
                                                            <td>
                                                                <input class="form-control" ng-model="newCfgLbl" id="newCfgLblField" name="newCfgLblField" placeholder="Variable label (optional)..." minlength="0" maxlength="30" />
                                                                <ng-messages role="alert" class="text-danger" for="modifySpec.newCfgName.$error">
                                                                    <ng-message when="minlength,maxlength">This value must be between 1 and 30 characters</ng-message>
                                                                </ng-messages>
                                                            </td>
                                                            
                                                            <!-- New Config value / setTo / useFrom -->
                                                            <td>
                                                                <div class="input-group  input-group-sm">
                                                                  <select id="newCfgSetToSelect" ng-show="newCfgType === 'Set To'" class="form-control" ng-model="newCfgSetTo">
                                                                    <option value="{{ svcVar }}" ng-repeat="svcVar in configSrcOptions">{{ svcVar }}</option>
                                                                  </select>
                                                                  
                                                                  <div class="input-group-btn dropup">
                                                                    <button id="newCfgTypeSelect" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ newCfgType }} <span class="caret"></span></button>
                                                                    <ul class="dropdown-menu">
                                                                      <li><a href type="button" ng-class="{ 'active': newCfgType === 'Explicit' }" 
                                                                        ng-click="newCfgType = 'Explicit';newCfgUseFrom='';newCfgSetTo='';" uib-tooltip="Set an explicit value">Explicit</a></li>
                                                                      <li><a href type="button" ng-class="{ 'active': newCfgType === 'Use From' }" 
                                                                        ng-click="newCfgType = 'Use From';newCfgSetTo='';newCfgUseFrom=configSrcOptions[0]" uib-tooltip="Inherit this value from a dependency"
                                                                        ng-disabled="!spec.depends || !spec.depends.length || !configSrcOptions">Use From</a></li>
                                                                      <li><a href type="button" ng-class="{ 'active': newCfgType === 'Set To' }"
                                                                        ng-click="newCfgType = 'Set To';newCfgUseFrom='';newCfgSetTo=configSrcOptions[0]" uib-tooltip="Override this value in a dependency"
                                                                        ng-disabled="!spec.depends || !spec.depends.length || !configSrcOptions">Set To</a></li>
                                                                    </ul>
                                                                  </div><!-- /input-group-btn -->
                                                                  
                                                                  <select id="newCfgUseFromSelect" ng-show="newCfgType === 'Use From'" class="form-control" ng-model="newCfgUseFrom">
                                                                    <option value="{{ svcVar }}" ng-repeat="svcVar in configSrcOptions">{{ svcVar }}</option>
                                                                  </select>
                                                                  
                                                                  <input ng-show="newCfgType === 'Explicit' || newCfgType === 'Set To'" class="form-control" ng-model="newCfgValue" ng-disabled="newCfgIsPassword"  placeholder="Default value..." name="newCfgValueField" id="newCfgValueField" minlength="0" maxlength="4096" />
                                                                  <ng-messages ng-show="newCfgType === 'Explicit'" role="alert" class="text-danger" for="modifySpec.newCfgName.$error">
                                                                    <ng-message when="minlength,maxlength">This value must be between 1 and 4096 characters</ng-message>
                                                                  </ng-messages>
                                                                </div><!-- /input-group -->
                                                            </td>
                                                            
                                                            <!-- New Config Can Override? -->
                                                            <td><input id="newCfgCanOverrideChackbox" type="checkbox" class="checkbox" ng-model="newCfgCanOverride" ng-disabled="newCfgIsPassword" /></td>
                                                            
                                                            <!-- New Config Is Password? -->
                                                            <td><input id="newCfgIsPasswordChackbox" type="checkbox" class="checkbox" ng-model="newCfgIsPassword" /></td>
                                                            
                                                            <!-- New Config Add button -->
                                                            <td>
                                                                <button id="addCfgBtn" type="button" class="btn btn-xs btn-primary" ng-disabled="!newCfgName" ng-click="addItem('config', { name: newCfgName, label: newCfgLbl, type: newCfgType, useFrom: newCfgUseFrom, setTo: newCfgSetTo, value: newCfgValue, canOverride: newCfgCanOverride, isPassword: newCfgIsPassword });newCfgName=newCfgValue='';newCfgLbl='';newCfgType='Explicit';">
                                                                    <i class="fa fa-fw fa-plus"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </uib-tab>
                            
                            <!-- Data Tab -->
                            <uib-tab heading="Data" index="5" id="dataTab">
                                <!-- List / edit mapped volumes -->
                                <div class="row">
                                    <div class="col-sm-12">
                                        <fieldset class="border-nds">
                                            <legend class="legend-fix">Volumes <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="bottom-right" uib-tooltip="Here you can map in any directory from your /home folder"></i></sup></legend>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-condensed table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th width="45%">Mount Path</th>
                                                            <th width="10%"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr ng-repeat="vol in spec.volumeMounts | orderBy:'mountPath'">
                                                            <td id="mountPathText">{{ vol.mountPath }}</td>
                                                            <td>
                                                                <button id="removeVolumeBtn" type="button" class="btn btn-xs btn-default" ng-click="removeItem(spec.volumeMounts, vol)">
                                                                    <i class="fa fa-fw fa-trash"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        
                                                        <!-- Add new volume -->
                                                        <tr>
                                                            <td>
                                                                <input class="form-control" ng-model="newVolPath" id="volPathField" name="volPathField" placeholder="Enter a container mount path..." ng-pattern="/^(\/[^\/ ]*)+\/?$/" />
                                                                <ng-messages class="text-danger" role="alert" for="modifySpec.volPathField.$error">
                                                                    <ng-message when="pattern">This field must be an absolute path (i.e. <i>/volume/path</i>)</li>
                                                                </ng-messages>
                                                            </td>
                                                            <td>
                                                                <button id="addVolumeBtn" type="button" class="btn btn-primary" ng-disabled="!newVolPath"
                                                                        ng-click="addItem('volumeMounts', { mountPath: newVolPath });newVolName=newVolPath=''">
                                                                    <i class="fa fa-fw fa-plus"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </uib-tab>
                            
                            <uib-tab heading="Ports" index="6" id="portsTab">
                                <!-- List / edit mapped ports -->
                                <div class="row">
                                    <div class="col-sm-12">
                                      <fieldset class="border-nds">
                                        <legend class="legend-fix">Ports <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="bottom-right" uib-tooltip="Should this application expose any ports externally?"></i></sup></legend>
                                        <div class="table-responsive">
                                          <table class="table table-condensed table-hover table-striped">
                                            <thead>
                                              <tr>
                                                <th width="30%" class="text-center">Protocol</th>
                                                <th width="30%">Port Number</th>
                                                <th width="30%">Context Path</th>
                                                <th width="10%"></th>
                                              </tr>
                                            </thead>
                                            <tbody>
                                              <tr ng-repeat="port in spec.ports">
                                                <td class="text-center">
                                                    <div class="btn-group" role="group">
                                                      <button id="portHttpBtn" type="button" class="btn btn-xs" ng-click="port.protocol='http'" ng-class="{ 'btn-primary': port.protocol === 'http', 'btn-default': port.protocol !== 'http' }">HTTP</button>
                                                      <button id="portTcpBtn" type="button" class="btn btn-xs" ng-click="port.protocol='tcp'" ng-class="{ 'btn-primary': port.protocol === 'tcp', 'btn-default': port.protocol !== 'tcp' }">TCP</button>
                                                    </div>
                                                </td>
                                                <td>
                                                  <input class="form-control" type="number" ng-model="port.port" id="portPortField{{ $index }}" name="portPortField{{ $index }}" required min="1" max="65535" />
                                                  <ng-messages class="text-danger" role="alert" for="modifySpec['portPortField'+$index].$error">
                                                      <ng-message when="required">Please enter a value or delete this port mapping</ng-message>
                                                      <ng-message when="min,max">This value must be a valid port number (1 - 65535)</ng-message>
                                                  </ng-messages>
                                                </td>
                                                <td>
                                                  <div ng-if="port.protocol === 'http'">
                                                        
                                                    <input class="form-control" type="text" required ng-pattern="/^\/[^\s]*$/" name="portPathField{{ $index }}" id="portPathField{{ $index }}" ng-model="port.contextPath" placeholder="Path..." />
                                                            
                                                    <ng-messages role="alert" class="text-danger" for="modifySpec['portPathField'+$index].$error">
                                                      <ng-message when="required">You must specify a path for HTTP ports</ng-message>
                                                      <ng-message when="pattern">This value must be a valid context path (such as '/' or '/index.html')</ng-message>
                                                    </ng-messages>
                                                  </div>
                                                </td>
                                                <td><button id="removePortBtn" type="button" class="btn btn-xs btn-default" ng-click="spec.ports.splice(spec.ports.indexOf(port), 1)"><i class="fa fa-fw fa-trash"></i></button></td>
                                              </tr>
                                              
                                              <!-- Map a new port -->
                                              <tr>
                                                <td class="text-center">
                                                  <div class="btn-group" role="group">
                                                    <button id="newPortHttpBtn" type="button" class="btn btn-xs" ng-click="portProtocol='http'" ng-class="{ 'btn-primary': portProtocol === 'http', 'btn-default': portProtocol !== 'http' }">HTTP</button>
                                                    <button id="newPortTcpBtn" type="button" class="btn btn-xs" ng-click="portProtocol='tcp'" ng-class="{ 'btn-primary': portProtocol === 'tcp', 'btn-default': portProtocol !== 'tcp' }">TCP</button>
                                                  </div>
                                                </td>
                                                <td class="text-center">
                                                  <input class="form-control" type="number" ng-model="portNumber" id="portNumberField" name="portNumberField" min="1" max="65535" />
                                                  <ng-messages class="text-danger" role="alert" for="modifySpec['portNumberField'].$error">
                                                      <ng-message when="min,max">This value must be a valid port number (1 - 65535)</ng-message>
                                                  </ng-messages>
                                                </td>
                                                <td>
                                                  <!-- XXX: We need ng-show here, to avoid creating an isolate scope -->
                                                  <div ng-show="portProtocol === 'http'">
                                                    <input class="form-control" type="text" required ng-pattern="/^\/[^\s]*$/" name="portPathField" id="portPathField" ng-model="portPath" placeholder="Path..." />
                                                                
                                                    <ng-messages role="alert" class="text-danger" for="modifySpec['portPathField'].$error">
                                                      <ng-message when="required">You must specify a path for HTTP ports</ng-message>
                                                      <ng-message when="pattern">Enter a valid context path (i.e. '/' or '/index.html')</ng-message>
                                                    </ng-messages>
                                                  </div>
                                                </td>
                                                <td><button id="addPortBtn" type="button" class="btn btn-xs btn-primary" ng-click="spec.ports.push({ protocol: portProtocol, port: portNumber, contextPath: portPath || '/' });portNumber=1;portPath='/';" 
                                                    ng-disabled="!portNumber || (portProtocol === 'http' && modifySpec['portPathField'].$invalid) || _.find(spec.ports, { protocol:portProtocol, port:portNumber })" ><i class="fa fa-fw fa-plus"></i></button></td>
                                              </tr>
                                          </table>
                                        </div>
                                      </fieldset>
                                    </div>
                                </div>
                            </uib-tab>
                            
                            <uib-tab heading="Resource Limits" index="9" id="resourceLimitsTab">
                                <div class="row">
                                    <div class="col-sm-12">
                                         <fieldset class="border-nds">
                                            <legend class="legend-fix">Resource Limits <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="bottom-right" uib-tooltip="How much of your total allocation would you like to grant this application?"></i></sup></legend>
                
                                            <!-- CPU Default -->
                                            <div class="form-group">
                                                <label for="limitCpuDefaultField">CPU Default <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The minimum amount of CPU to allocate"></i></sup></label>
                                                <div class="input-group">
                                                  <input type="number" class="form-control" id="limitCpuDefaultField" name="limitCpuDefaultField" 
                                                        ng-model="spec.resourceLimits.cpuDefault" aria-describedby="cpudefault-addon" ng-min="10" ng-max="{{ spec.resourceLimits.cpuMax }}" required />
                                                  <span class="input-group-addon" id="cpudefault-addon">m</span>
                                                </div>
                                                
                                                <ng-messages class="text-danger" for="modifySpec.limitCpuDefaultField.$error" role="alert">
                                                  <ng-message when="required">This field is required</ng-message>
                                                  <ng-message when="min">This field must be above the minimum (10)</ng-message>
                                                  <ng-message when="max">This field must be below the maximum ({{ spec.resourceLimits.cpuMax }})</ng-message>
                                                </ng-messages>
                                            </div>
                                            
                                            <!-- CPU Max -->
                                            <div class="form-group">
                                                <label for="limitCpuMaxField">CPU Max <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The maximum CPU this application is allowed to consume"></i></sup></label>
                                                <div class="input-group">
                                                  <input type="number" class="form-control" id="limitCpuMaxField" name="limitCpuMaxField" 
                                                        ng-model="spec.resourceLimits.cpuMax" aria-describedby="cpumax-addon" ng-min="10" required />
                                                  <span class="input-group-addon" id="cpumax-addon">m</span>
                                                </div>
                                                
                                                <ng-messages class="text-danger" for="modifySpec.limitCpuMaxField.$error" role="alert">
                                                  <ng-message when="required">This field is required</ng-message>
                                                  <ng-message when="min">This field must be above the minimum (10)</ng-message>
                                                </ng-messages>
                                            </div>
                                            
                                            <!-- Memory Default -->
                                            <div class="form-group">
                                                <label for="limitMemDefaultField">Memory Default <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The minimum amount of memory to allocate"></i></sup></label>
                                                <div class="input-group">
                                                  <input type="number" class="form-control" id="limitMemDefaultField" name="limitMemDefaultField" 
                                                        ng-model="spec.resourceLimits.memDefault" aria-describedby="memdefault-addon" ng-min="10" ng-max="{{ spec.resourceLimits.memMax }}" required />
                                                  <span class="input-group-addon" id="memdefault-addon">M</span>
                                                </div>
                                                
                                                <ng-messages class="text-danger" for="modifySpec.limitMemDefaultField.$error" role="alert">
                                                  <ng-message when="required">This field is required</ng-message>
                                                  <ng-message when="min">This field must be above the minimum (10)</ng-message>
                                                  <ng-message when="max">This field must be below the maximum ({{ spec.resourceLimits.memMax }})</ng-message>
                                                </ng-messages>
                                            </div>
                                            
                                            <!-- Memory Max -->
                                            <div class="form-group">
                                                <label for="limitMemMaxField">Memory Max <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The maximum amount of memory this application is allowed to consume"></i></sup></label>
                                                <div class="input-group">
                                                  <input type="number" class="form-control" id="limitMemMaxField" name="limitMemMaxField" 
                                                        ng-model="spec.resourceLimits.memMax" aria-describedby="memmax-addon" ng-min="10" required />
                                                  <span class="input-group-addon" id="memmax-addon">M</span>
                                                </div>
                                                
                                                <ng-messages class="text-danger" for="modifySpec.limitMemMaxField.$error" role="alert">
                                                  <ng-message when="required">This field is required</ng-message>
                                                  <ng-message when="min">This field must be above the minimum (10)</ng-message>
                                                </ng-messages>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </uib-tab>
                            
                            <!-- Development Tab -->
                            <uib-tab heading="Development" index="3" id="developmentEnvironmentTab">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <fieldset class="border-nds">
                                            <legend class="legend-fix">Developer Environment <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="bottom-right" uib-tooltip="Choose an application that can be used to develop {{ spec.label }} (if applicable)"></i></sup></legend>
                                            <select id="developerEnvironmentSelect" class="form-control" ng-model="spec.developerEnvironment">
                                                <option ng-repeat="devEnv in specs | hasTag:'Development environment'" value="{{ devEnv.key }}">
                                                    {{ devEnv.label }} <span class="pull-right"><{{ devEnv.key }}></span>
                                                </option>
                                            </select>
                                        </fieldset>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-sm-12">
                                        <fieldset class="border-nds">
                                            <legend class="legend-fix">Source Repositories <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="bottom-right" uib-tooltip="Links to any related source repositories (if applicable)"></i></sup></legend>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover table-condensed">
                                                    <thead>
                                                        <tr>
                                                            <th width="40%">Repository Type</th>
                                                            <th width="40%">URL</th>
                                                            <th width="20%"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr ng-repeat="repo in spec.repositories">
                                                            <td id="repoTypeText">
                                                                <span ng-if="repo.type === 'git'">Git / Bitbucket</span>
                                                                <span ng-if="repo.type === 'hg'">Mercurial</span>
                                                                <span ng-if="repo.type === 'svn'">SVN</span>
                                                                <span ng-if="repo.type === 'cvs'">CVS</span>
                                                            </td>
                                                            <td id="repoUrlText">{{ repo.url }}</td>
                                                            <td class="text-center"><button id="removeRepoBtn" type="button" class="btn btn-xs btn-default" ng-click="spec.repositories.splice(spec.repositories.indexOf(repo))"><i class="fa fa-fw fa-trash"></i></button></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <div class="row">
                                                <div class="col-xs-5">
                                                    <select id="repoTypeSelect" class="form-control" ng-model="newRepoType">
                                                        <option value="git">Git / Bitbucket</option>
                                                        <option value="hg">Mercurial</option>
                                                        <option value="svn">Subversion</option>
                                                        <option value="cvs">CVS</option>
                                                    </select>
                                                </div>
                                                <div class="col-xs-5">
                                                    <input type="url" class="form-control" ng-model="newRepoUrl" id="repoUrlField" name="repoUrlField" placeholder="Enter a repository URL..." />
                                                    <ng-messages class="text-danger" role="alert" for="modifySpec.repoUrlField.$error">
                                                        <ng-message when="url">This field must be a valid URL</ng-message>
                                                    </ng-messages>
                                                </div>
                                                <div class="col-xs-2">
                                                    <button id="addRepoBtn" type="button" class="btn btn-primary" ng-disabled="!newRepoType || !newRepoUrl" ng-click="addItem('repositories', { type: newRepoType, url: newRepoUrl });newRepoUrl=''">
                                                        <i class="fa fa-fw fa-plus"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </uib-tab>
                        </uib-tabset>
                    </div>
                </div>
            </div>
        </div>
    
    
        <div class="row">
            <div class="col-sm-12">
                <div class="pull-right">
                    <button id="saveBtn" class="btn btn-success" type="submit" ng-disabled="(spec.key | stackExistsFromSpec) || !keyUnique || modifySpec.$invalid"><i class="fa fa-fw fa-save"></i> Save</button>
                    <button id="cancelBtn" class="btn btn-danger" type="button" ng-click="cancel()"><i class="fa fa-fw fa-times"></i> Cancel</button>
                </div>    
            </div>
        </div>
    </form>
</section>
